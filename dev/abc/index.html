<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ABC inference · ABC-MK</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ABC-MK</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Package Overview</span><ul><li><a class="tocitem" href="../analytical/">Analytical estimations</a></li><li class="is-active"><a class="tocitem" href>ABC inference</a><ul class="internal"><li><a class="tocitem" href="#Prior-distributions-from-analytical-estimations-1"><span>Prior distributions from analytical estimations</span></a></li><li><a class="tocitem" href="#*ABC*-inference-1"><span><em>ABC</em> inference</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Package Overview</a></li><li class="is-active"><a href>ABC inference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ABC inference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jmurga/Analytical.jl/blob/master/docs/src/abc.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="*ABC*-inference-from-empirical-data-1"><a class="docs-heading-anchor" href="#*ABC*-inference-from-empirical-data-1"><em>ABC</em> inference from empirical data</a><a class="docs-heading-anchor-permalink" href="#*ABC*-inference-from-empirical-data-1" title="Permalink"></a></h1><h2 id="Prior-distributions-from-analytical-estimations-1"><a class="docs-heading-anchor" href="#Prior-distributions-from-analytical-estimations-1">Prior distributions from analytical estimations</a><a class="docs-heading-anchor-permalink" href="#Prior-distributions-from-analytical-estimations-1" title="Permalink"></a></h2><p>In this example we provide a solution to replicate results at <a href="https://doi.org/10.1038/s41559-019-0890-6">Uricchio et al. 2019</a>. We will simulate <span>$10^6$</span> summary statistics from random <em>DFE</em> to use as prior distribution in <em>ABCreg</em>. In this case we will need a set of empirical observed values in order to subset the summary statistics.</p><p>We need to set the model accounting for the sampling value. The <em>SFS</em> is expected to be in raw frequencies. If the model is not properly set up, the <em>SFS</em> will not be correctly parsed. In our case, we are going to set up a model with default parameters only to parse the <em>SFS</em> and convolute the observed frequencies with a binomial distribution.</p><pre><code class="language-julia">Analytical.changeParameters(N=1000,n=661,convoluteBinomial=true)</code></pre><p>Once the model account for the number of samples we can open the files. The function <code>Analytical.parseSfs</code> will return polymorphic and divergent counts and SFS accounting for the whole spectrum: <code>collect(1:adap.nn)/adap.nn</code>. In addition an output file will be created contained the observed values to input in <em>ABCreg</em>.</p><pre><code class="language-julia">path= &quot;/home/jmurga/mktest/data/&quot;;suffix=&quot;txt&quot;;
files = path .* filter(x -&gt; occursin(suffix,x), readdir(path))

empiricalValues = Analytical.parseSfs(data=files,output=&quot;testData.tsv&quot;,sfsColumns=[3,5],divColumns=[6,7])</code></pre><p>We make a function to perform <span>$10^6$</span> simulated values. We solve the analytical approximation taking into account random and independent values to draw <em>DFE</em> and <span>$\alpha_{(x)}$</span>. Each parameter combination are replicated to 5% frequency bins background selection values (saved at <code>adap.bRange</code>). </p><p>In Julia you can easily parallelize a loop using <code>$ export JULIA_NUM_THREADS=8</code>. Each iteration will be executed in a thread. In order to check the threads configured, just use in the julia console <code>julia&gt; Threads.nthreads()</code> before the execution. We compute this example in a Intel i7-7700HQ (8) @ 3.800GHz laptop with 16GB of RAM using 8 threads. Please check <a href="https://docs.julialang.org/en/v1/manual/parallel-computing/">parallelization manual</a> in order to send the process in a multicore system (or just put two process manually the <a href="https://github.com/jmurga/Analytical.jl/blob/master/scripts/alphaSumStats.jl"><em>alphaSumStats.jl</em></a> , a script provided to launch from command line).</p><pre><code class="language-julia">function summStats(iter,data)
#@threads
	@showprogress for i in 1:iter
		gam_neg   = -rand(80:400)
		gL        = rand(10:20)
		gH        = rand(200:500)
		alLow     = rand(collect(0.0:0.1:0.2))
		alTot     = rand(collect(0.0:0.05:0.2))

		for j in adap.bRange
			Analytical.changeParameters(
				gam_neg             = gam_neg,
				gL                  = gL,
				gH                  = gH,
				alLow               = alLow,
				alTot               = alTot,
				theta_f             = 1e-3,
				theta_mid_neutral   = 1e-3,
				al                  = 0.184,
				be                  = 0.000402,
				B                   = j,
				bRange              = adap.bRange,
				pposL               = 0.001,
				pposH               = 0.0,
				N                   = 1000,
				n                   = 661,
				Lf                  = 10^6,
				rho                 = 0.001,
				TE                  = 5.0,
				convoluteBinomial   = false
			)

			Analytical.set_theta_f()
			theta_f        = adap.theta_f
			adap.B         = 0.999
			Analytical.set_theta_f()
			Analytical.setPpos()
			adap.theta_f   = theta_f
			adap.B         = j

			x,y,z          = Analytical.alphaByFrequencies(gammaL=adap.gL,gammaH=adap.gH,pposL=adap.pposL,pposH=adap.pposH,observedData=data)
			Analytical.summaryStatistics(&quot;/home/jmurga/prior.csv&quot;, z)
		end
	end
end

# Launch 10^6 solutions
@time summStats(58824,empiricalValues)</code></pre><h2 id="*ABC*-inference-1"><a class="docs-heading-anchor" href="#*ABC*-inference-1"><em>ABC</em> inference</a><a class="docs-heading-anchor-permalink" href="#*ABC*-inference-1" title="Permalink"></a></h2><p>Generic ABC methods proceed by three main steps: (1) first sampling parameter values from prior distributions, (2) next simulating a model and calculating informative summary statistics, and lastly (3) comparing the simulated summary statistics to observed data. The parameter values that produce summary statistics that best match the observed data form an approximate posterior distribution. We link Julia with <em>ABCreg</em>. It will output one file per line in data. The files contain the posterior distributions. We return the posterior distributions, mean and quantiles.</p><pre><code class="language-julia">posteriors, results  = Analytical.ABCreg(data=&quot;/home/jmurga/data.tsv&quot;,prior=&quot;/home/jmurga/prior.tsv&quot;, nparams=27, nsummaries=24, outputPath=&quot;/home/jmurga/&quot;, outputPrefix=&quot;outPaper&quot;, tolerance=0.001, regressionMode=&quot;T&quot;,regPath=&quot;/home/jmurga/ABCreg/src/reg&quot;)</code></pre><p>You can easily plot the posterior distributions using Julia or just input the files at your favorite plot software.</p><pre><code class="language-julia">using Plots, Plots.PlotMeasures, StatsPlots, LaTeXStrings

function plotPosterior(data,file,imgSize)

	Plots.gr()
	Plots.theme(:wong2)

	p1 = StatsPlots.density(data],
							legend    = :topright,
							fill      = (0, 0.3),
							xlabel    = L&quot;\alpha&quot;,
							label     = [L&quot;\alpha_S&quot; L&quot;\alpha_W&quot; L&quot;\alpha&quot;],
							ylabel    = &quot;Posterior density&quot;,
							lw        = 0.5,
							fmt       = :svg,
							size      = imgSize
						)
	Plots.savefig(file)

	return p1
end

p = plotPosterior(posterior[1],&quot;/home/jmurga/posterior1.svg&quot;,(800,600))</code></pre><p><a href="https://nbviewer.jupyter.org/github/jmurga/Analytical.jl/blob/master/scripts/analyticalAlphaAndPriors.ipynb"><img src="https://img.shields.io/badge/render-nbviewer-orange.svg" alt="NBViewer"/></a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../analytical/">« Analytical estimations</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 16 September 2020 08:59">Wednesday 16 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
